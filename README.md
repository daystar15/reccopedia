# Reccopedia 프로젝트 만들기

### 기간
2023-01-31 ~ 2023-03-07

### 개발 환경
스프링부트, mySql, myBatis, jQuery

### 개발 문서

* 메인페이지<br/>
http://43.200.163.147:8080/main<br/>
테스트 가계정: test@test.com / testtest<br/>

* 어드민페이지<br/>
http://43.200.163.147:8080/admin/login<br/>
어드민 계정: admin / admin<br/>

* 일정 : https://docs.google.com/spreadsheets/d/13H9KnPqFq9CeIpvmd-0mHuuwhWSSFfISBZb5xugIfnQ/edit#gid=0 <br/>
* 테이블 설계 : https://docs.google.com/spreadsheets/d/1F2QyPs_9ZR0TStjXLO5ghdRcHQhgNDS1dGjM3SAKR_s/edit#gid=0 <br/>
* URL 설계: https://docs.google.com/spreadsheets/d/1F2QyPs_9ZR0TStjXLO5ghdRcHQhgNDS1dGjM3SAKR_s/edit#gid=546147353 <br/>
* API 설계: https://docs.google.com/spreadsheets/d/1F2QyPs_9ZR0TStjXLO5ghdRcHQhgNDS1dGjM3SAKR_s/edit#gid=1420148930 <br/>
* 포트폴리오 문서: https://www.notion.so/Recopedia-4a0e95927510427dbbdfb034288d8ce6?pvs=4

-----
# 기능명세

## 1. 로그인/회원가입/중복확인

로그인 기능은 사용자가 아이디와 비밀번호를 입력하면, 서버로 전송되고 서버에서는 입력된 아이디와 비밀번호를 데이터베이스에 저장된 정보와 비교하여 인증합니다. 만약 인증이 성공하면, 서버는 세션에 사용자 정보를 저장하고 로그인 성공 페이지로 응답하고, 인증이 실패하면 서버는 로그인 실패 페이지로 응답합니다.

회원가입 기능은 사용자가 이름, 이메일, 비밀번호를 입력하면, 입력된 정보를 서버로 전송하고 서버에서는 입력된 정보를 데이터베이스에 저장합니다. 저장이 완료되면, 서버는 회원가입 성공 페이지로 응답하고 저장이 실패하면 서버는 회원가입 실패 페이지로 응답합니다.

중복확인 기능은 사용자가 이메일 중복확인 버튼을 클릭하면, 입력된 이메일을 서버로 전송하고 서버에서는 입력된 이메일이 이미 데이터베이스에 저장되어 있는지 확인합니다. 만약 중복이 아니면, 서버는 "사용 가능한 이메일입니다"라는 안내 메시지를 응답하고 중복이면, 서버는 "이미 사용 중인 이메일입니다"라는 안내 메시지를 응답합니다.

## 2. 메인 페이지

TMDB API는 영화 및 TV 데이터베이스를 OpenAPI 형태로 무료로 제공합니다. 이를 활용하기 위해 **RestTemplate**을 사용하여 HTTP 요청 및 응답을 처리합니다. **RESTTemplate**은 스프링 프레임워크에서 제공하는 HTTP 통신을 단순화하고 추상화한 클래스입니다. 이를 통해 RESTful 웹 서비스와의 통신을 위한 다양한 HTTP 메서드를 지원하고 HTTP 요청을 보내고 응답을 받는 메서드를 제공하며, JSON, XML 등의 다양한 데이터 형식을 처리할 수 있습니다.

메인 페이지에서는 TMDB API를 호출하여 전 세계 인기 순위, 넷플릭스/디즈니플러스의 인기 작품, 오늘의 추천 배우 영화목록을 포함한 영화와 TV 페이지를 구성합니다. 이를 위해 DAO에서 TMDB API를 호출하여 뷰에 나타낼 리턴값을 정의하고, 이를 컨트롤러에서 모델에 데이터를 담아 뷰로 전달합니다.

메인 페이지 상단에는 박스오피스 순위와 넷플릭스 인기 작품을 가져오기 위해 TMDB API로 받아온 JSON을 List<Map>으로 변환하여 JSTL로 foreach문을 돌려 여러 개의 정보를 표현하였습니다.

메인 페이지 하단 부분은 각 작품의 평점이 얼마나 많이 기록되었는지를 나타내고 있습니다. 이 부분은 DB에서 데이터를 가져와 뷰로 전달합니다. 이를 위해 DAO에서 DB에 저장된 작품 평점 정보를 가져와 뷰에 나타낼 리턴값을 정의하고, 컨트롤러에서 모델에 데이터를 담아 뷰로 전달합니다. 이를 통해 사용자는 각 작품의 평점 정보를 확인할 수 있습니다.

검색 탭은 사용자가 검색어를 입력하면 해당 검색어에 대한 컨텐츠를 검색할 수 있는 기능입니다. 이를 구현하기 위해 폼 기능을 활용하여 검색창에 입력된 검색어를 AJAX를 통해 컨트롤러로 전송합니다. 컨트롤러와 연결된 BO가 RestTemplate으로 불러온 TMDB API값이 해당하는 컨텐츠를 모델에 담아 뷰로 전달합니다.

뷰에서는 JSTL if문을 사용하여 TMDB에서 받아온 데이터가 검색 결과가 TV인지, 영화인지를 판별하기 위해 JSON의 값 중 media_type을 이용하여 TV일 때는 TV 페이지로 넘어가고 영화일 때는 영화 페이지로 넘어가도록 구현하였습니다.

이러한 방식으로 검색 탭을 구현함으로써 사용자는 검색어를 통해 자신이 원하는 컨텐츠를 쉽게 찾을 수 있고, TV와 영화를 모두 확인할 수 있습니다. 또한, 검색 결과 페이지에서 각각의 페이지로 쉽게 이동할 수 있으므로 사용자의 이용 경험을 향상시킬 수 있습니다.

## 3. 컨텐츠 페이지

레코피디아 프로젝트는 **RESTful API**를 사용하여 영화와 TV프로그램의 정보를 요청하고, JSON 형식으로 반환된 데이터를 파싱하여 사용합니다. API에서는 제목, 장르, 출시일, 기본 줄거리 등과 같은 기본 정보를 제공합니다. 컨텐츠 페이지는 한 컨텐츠에 관련된 여러 항목을 담기 때문에 항목마다 나타나는 JSON의 형태가 다양합니다. 이를 효율적으로 뷰에서 나타내기 위해 List<String>, Map 또는 List<Map>으로 가공합니다.

컨텐츠 페이지에서는 해당 컨텐츠의 유튜브 링크와 관련 이미지, 추천 항목도 제공합니다. 추천 항목은 TMDB API의 Get Recommendations를 활용하여 영화의 API ID를 받아와서 나타낼 수 있도록 합니다.

현재 데이터가 부족하여 평점 값을 제공할 수 없어, API에서 제공하는 평점 정보를 활용하여 평점 값을 계산합니다. 이를 구글 차트를 이용하여 사용자가 쉽게 볼 수 있도록 시각적으로 표현합니다. 이를 위해 구글 차트 API를 사용하고, 컨트롤러에서 API에서 제공하는 평점 정보를 가져와 평점 값을 계산한 후 모델에 담아 뷰에서 사용합니다.

뷰에서는 **구글 차트**를 이용하여 사용자가 해당 컨텐츠의 평점 정보를 쉽게 확인할 수 있도록 합니다. 뷰에서는 영화 정보 JSON의 vote_average 값을 가져와 자바스크립트로 구글 차트 API를 호출하고, 평점 값을 담은 데이터를 차트 형식으로 표현합니다. 다만, 레코피디아에서는 5점 만점으로 하기 때문에 가져온 값을 2로 나누어 표현합니다. 이처럼 사용자는 차트를 통해 컨텐츠의 평점 정보를 한 눈에 확인할 수 있습니다.

## 4. 보고싶어요, 보는중, 관심없어요, 평점주기

해당 프로젝트에서는 CRUD를 구현하여 사용자가 편리하게 평점주기, 보고싶어요, 보는 중, 관심없어요 버튼을 토글로 선택할 수 있도록 하고 있습니다. 이를 위해 스프링 MVC를 기반으로 하여 구현하였습니다. 

우선, 사용자가 평점을 입력할 때마다 갱신되는 평점주기 기능은 스프링 MVC에서 제공하는 컨트롤러를 이용하여 구현하였습니다. 사용자가 평점을 입력하면 해당 값을 DB에 저장하고, 다시 평점을 입력하면 DB에서 해당 값을 갱신하는 방식으로 구현되었습니다.

다음으로, 테이블에서 삭제하는 기능은 스프링 MVC에서 제공하는 CRUD 기능 중 **Delete**를 이용하여 구현하였습니다. 사용자가 버튼을 선택하면 해당 값을 DB에서 삭제하며, 이를 위해 **Mybatis**를 이용하여 DB와의 연동을 구현하였습니다.

또한, 사용자가 버튼을 선택하면 해당 값을 토글로 변경될 수 있도록 하였습니다.  이를 위해 CSS에서는 클릭했을 때의 값을 미리 정의하였고, JSTL if문으로 조건을 걸어 사용자가 버튼을 선택하면 해당 값을 변경할 수 있도록 구현하였습니다. 이후, 값이 변경되면 Ajax를 이용하여 서버와 통신하여 값을 갱신하도록 구현하였습니다. 

이를 통해 사용자의 경험을 더욱 개선시키고, 서버와의 효율적인 통신을 구현하여 웹 어플리케이션의 성능을 향상시켰습니다.

## 5. 댓글

댓글에 관련된 페이지에서는 스포일러, 댓글 신고, 댓글 삭제 기능을 구현하였습니다.

먼저 스포일러 기능은 댓글 입력란에 스포일러를 지정할 수 있는 버튼을 추가하고, 이를 통해 **checkbox** 값을 가져와서 true일 때는 스포일러가 가려지도록 설정하였습니다. 그리고 댓글을 저장하면 true나 false값을 필수적으로 가지고 저장됩니다.

다음으로 댓글 신고 기능은 내가 쓴 댓글이 아닌 타인의 댓글은 신고 버튼을 통해 관리자 페이지에서 신고 목록을 볼 수 있도록 구현하였습니다. 이를 위해 댓글 신고 버튼을 누르면 해당 댓글의 정보를 서버로 전송하고, 서버에서는 이를 데이터베이스에 저장하도록 구현하였습니다.

마지막으로 댓글 삭제 기능은 내가 쓴 댓글들은 삭제 버튼을 통해 삭제할 수 있도록 하였습니다. 이를 위해 댓글 삭제 버튼을 누르면 해당 댓글의 정보를 서버로 전송하고, 서버에서는 이를 데이터베이스에서 삭제하도록 구현하였습니다.

## 6. 평가하기 페이지

영화와 TV로 나뉘는 구성으로 스프링 MVC 패턴을 사용하여 댓글 및 평점 등의 사용자 요청을 처리합니다. 댓글이나 평점을 입력할 때는 **HTTP POST** 요청을 사용하며, BO에서는 **RESTTemplate**을 이용하여 일일 트렌드 API 정보를 가져옵니다.

사용자가 댓글이나 평점을 입력하면 각각의 DAO에서 해당 데이터를 처리하여 데이터베이스에 저장합니다. 입력된 별점에 대해서는 입력할 때마다 "별점이 입력되었습니다"라는 안내 문구가 표시되도록 구현합니다.

## 7. 컬렉션

작품 추가하기 기능에서 검색한 작품을 추가하면 컬렉션이 생성됩니다. 이 기능은 사용자가 선택한 작품 정보를 DB에 저장하고, 해당 컬렉션 정보를 생성하는 방식으로 이루어집니다. 또한, 컬렉션 삭제 시에는 DB에서 해당 컬렉션 정보를 삭제하고, 컬렉션과 매칭된 작품 정보도 함께 삭제합니다. 

컬렉션 정보와 작품 정보를 저장하기 위해서는 DB 테이블을 만들어야 합니다. 저는 'collection' 테이블과 'collection_content' 테이블을 만들었습니다. 'collection' 테이블은 컬렉션 정보를 저장하고, 'collection_content' 테이블은 작품 정보를 저장합니다. 두 테이블은 'collection'의 id값을 통해 매칭됩니다. 

컬렉션 정보와 작품 정보를 DB에 저장하는 방법은 Spring MVC에서는 Mybatis를 사용하여 처리하였습니다. 이를 위해서는 **Entity 클래스**를 만들어야 하며 저는, 'Collection' 클래스와 'collection_content' 클래스를 만들고 **Mybatis를 통해 DB와 매핑**하였습니다.

컬렉션 삭제 시에는 해당 컬렉션과 매칭된 작품 정보를 함께 삭제해야 합니다. 이를 위해서는 'collection' 테이블에서 해당 컬렉션과 매칭된 작품 정보를 먼저 삭제한 후, 'collection_content' 테이블에서 해당 컬렉션 정보를 삭제하는 방식으로 구현하였습니다.

사용자가 컬렉션을 삭제하면 컬렉션과 매칭된 작품 정보도 함께 삭제되어야 하기 때문에, 이를 안내하는 메시지를 사용자에게 보여줄 필요가 있습니다. 아직 이 부분은 사용자에게 임시저장 문구를 통해 안내하고 있지만 다음 버전에서는 예를 들어, "컬렉션을 삭제하시겠습니까?라는 문구를 띄워  해당 컬렉션에 포함된 모든 작품 정보도 함께 삭제될 수 있도록 처리할 예정입니다. 삭제하시려면 '확인' 버튼을 눌러주세요."와 같은 메시지를 보여줄 수 있습니다. 이를 구현하기 위해서는 JavaScript와 AJAX를 사용하여 Confirm 메시지를 띄우고, 확인 버튼을 누르면 AJAX를 통해 서버에 컬렉션 삭제 요청을 보내는 방식으로 구현할 수 있습니다.

## 8. 관리자 페이지

관리자 페이지에서는 회원 목록과 댓글 신고 목록을 확인할 수 있습니다. 회원 목록과 댓글 신고 목록을 보여주기 위해서는 데이터베이스와 연동이 필요합니다. 따라서, 데이터베이스와의 연동을 위해 MyBatis를 이용하였습니다. AdminController는 회원 목록은 UserBO를 불러오며 UserBO는  회원 목록을 조회하고, 조회된 회원 목록을 모델에 담아서 관리자 페이지의 뷰 페이지로 전달합니다. 관리자 뷰 페이지에서는 모델에 담긴 회원 목록을 테이블로 표현하여 보여줍니다.

댓글 신고 목록도 AdminController가 CommentBO를 불러와 댓글 신고 목록을 조회하고, 조회된 댓글 신고 목록을 모델에 담아서 뷰 페이지로 전달합니다. 뷰 페이지에서는 모델에 담긴 댓글 신고 목록을 테이블로 표현하여 보여줍니다.

TV와 영화에 입력된 댓글 수는 **Google Charts API**를 이용하여 시각적으로 표현됩니다. CommentBO는 TV와 영화에 입력된 댓글 수를 조회하고, 조회된 데이터를 모델에 담아서 AdminController가 뷰 페이지로 전달합니다. 뷰 페이지에서는 모델에 담긴 데이터를 Google Charts API를 이용하여 차트로 표현하여 보여줍니다.

## 9. 유저 페이지

유저 페이지에서는 유저의 닉네임, 자기소개, 프로필 사진, 배경 사진을 변경할 수 있습니다.</br>
이를 구현하기 위해서는 HTML과 JavaScript, AWS서비스를 사용하여야 합니다.

HTML에서는 file 태그를 사용하여 이미지 파일을 선택할 수 있습니다. 하지만 디자인상 file 태그를 가리고 이미지를 클릭하면 file 태그가 발생하도록 해야 합니다. 이를 위해 **JavaScript를 사용하여 이미지를 클릭하면 file 태그를 호출**하도록 하였습니다. 사용자가 선택한 이미지는 AWS 서버의 images 폴더에 저장되도록 로직을 구현하였습니다.

또한, 사용자의 닉네임과 자기소개도 함께 변경할 수 있습니다. 이를 위해 POST 방식으로 요청을 보내고, Controller에서는 DAO를 통해 DB에 변경된 정보를 저장합니다.

유저가 남긴 평점 개수, 댓글 개수, 컬렉션 수부터 영화와 TV별로 유저가 담은 보고싶어요, 보는중, 평가하기 값들이 나타납니다. 이를 위해 DAO를 통해 DB에서 정보를 가져오고, HTML에서는 숫자로 나타내기 위해 jstl의 length를 사용하여 처리했습니다. 이를 통해 유저 페이지에서는 다양한 정보를 제공할 수 있습니다.

-----
# 향후과제
  
  |버전|설명|완료 여부|
|:---:|:---|:---:|
|1|기획 부분은 모두 구현 완료함|완료|
  |2|현재는 컬렉션 테이블에 임시 저장 중임을 사용자에게 알리고, 임시 저장을 하지 않으면 해당 내용이 그대로 저장되니 취소 버튼을 눌러야 한다는 설명 문구를 추가함.</br> 그러나 이 부분의 불편함을 해결하기 위해 "컬렉션을 삭제하시겠습니까?라는 문구를 띄워  해당 컬렉션에 포함된 모든 작품 정보도 함께 삭제될 수 있도록 처리할 예정입니다.</br> 삭제하시려면 '확인' 버튼을 눌러주세요."와 같은 메시지를 보여줄 수 있습니다. </br>이를 구현하기 위해서는 JavaScript와 AJAX를 사용하여 Confirm 메시지를 띄우고, 확인 버튼을 누르면 AJAX를 통해 서버에 컬렉션 삭제 요청을 보내는 방식으로 구현|미완료|
|2|"보고싶어요", "보는 중", "관심없어요"의 장르 ID 값을 각각 불러와서, 사용자가 자주 보는 장르를 기반으로 하는 사용자 기반 추천 시스템을 메인에 구성할 수 있도록 함.|미완료|
